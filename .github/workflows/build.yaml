on:
    workflow_dispatch:
jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Get Source Code
        uses: actions/checkout@v6

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y cmake meson pkg-config ninja-build python3 python3-pip

      - name: Download and Extract Android NDK
        run: |
            NDK_RELEASE=r29
          
            # url pointing to download
            URL=https://dl.google.com/android/repository/android-ndk-${NDK_RELEASE}-linux.zip
          
            # download ndk into ndk.zip
            curl -L "${URL}" -o ndk.zip
          
            # extract ndk contents
            unzip ndk.zip -d ./ndk
          
            FULL_NDK_PATH=$(realpath ./ndk/android-ndk-${NDK_RELEASE})
          
            echo "NDK_PATH=${FULL_NDK_PATH}" >> $GITHUB_ENV
            
          
      - name: Assert NDK folder exists and is not empty
        run: |
          if [ ! -d "${NDK_PATH}" ] || [ -z "$(ls -A "${NDK_PATH}")" ]; then
            echo "ERROR: Download of android ndk didnt work, ${NDK_PATH} is either empty or doesnt exist"
            exit 1
          fi
          
          echo "Android NDK successfully installed at ${NDK_PATH}"

      - name: Run Script
        run: |
          python main.py --android_ndk_version=${NDK_VERSION} --android_ndk_path=${NDK_PATH} --android_ndk_host=linuxâ€‘x86_64 --auto_accept_licence=y

      - name: Assert Folders Exists
        run: |
          [ -d "source" ] && [ "$(ls -A source)" ] || { echo "Source folder is missing or empty"; exit 1; }
          [ -d "build" ] && [ "$(ls -A build)" ] || { echo "Build folder is missing or empty"; exit 2; }
          [ -d "install" ] && [ "$(ls -A install)" ] || { echo "Install folder is missing or empty"; exit 3; }